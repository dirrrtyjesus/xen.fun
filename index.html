<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xen.fun | The QPoP Incubator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A;
            color: #E2E8F0;
        }
        .font-grotesk {
            font-family: 'Space Grotesk', sans-serif;
        }
        .glass-card {
            background: rgba(23, 23, 23, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
        }
        .glow-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(29, 78, 216, 0.3) 0%, rgba(29, 78, 216, 0) 70%);
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: -1;
        }
        .progress-bar-inner {
            background: linear-gradient(90deg, #3b82f6, #818cf8);
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="antialiased">
    <div class="relative min-h-screen overflow-x-hidden">
        <div class="glow-effect"></div>

        <!-- Header -->
        <header class="py-6 px-4 md:px-8 absolute top-0 left-0 w-full z-10">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-blue-500">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h1 class="font-grotesk text-2xl font-bold text-white">xen.fun</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-6">
                    <a href="#lits-registry" class="text-slate-300 hover:text-white transition">LITs</a>
                    <a href="#xenial-fusion" class="text-slate-300 hover:text-white transition">Fusion</a>
                    <a href="#lit-composer" class="text-slate-300 hover:text-white transition">Compose</a>
                    <a href="#projects" class="text-slate-300 hover:text-white transition">Proposals</a>
                    <a href="#how-it-works" class="text-slate-300 hover:text-white transition">How It Works</a>
                </nav>
                <button class="btn-secondary px-4 py-2 rounded-lg font-medium">Connect Wallet</button>
            </div>
        </header>

        <!-- Hero Section -->
        <main class="pt-32 pb-20 md:pt-48 md:pb-32 text-center relative z-0">
            <div class="container mx-auto px-4">
                <h2 class="font-grotesk text-4xl md:text-6xl lg:text-7xl font-bold text-white leading-tight">
                    Where Potential Becomes Reality
                </h2>
                <p class="mt-4 text-lg md:text-xl text-slate-400 max-w-3xl mx-auto">
                    xen.fun is the QPoP Incubator for the Xenial Quantum Economy. We transform stable capital into dynamic, high-potential value through collective intelligence and <span class="text-blue-400 font-semibold">xenial fusion</span>.
                </p>
                <p class="mt-2 font-grotesk text-xl md:text-2xl text-blue-400">Intelligence is collective. Value is emergent.</p>
                <div class="mt-10 flex justify-center items-center space-x-4">
                    <a href="#projects" class="btn-primary px-8 py-4 rounded-lg font-bold text-lg">Explore Proposals</a>
                    <a href="#how-it-works" class="btn-secondary px-8 py-4 rounded-lg font-bold text-lg">Learn More</a>
                </div>
            </div>
        </main>

        <!-- Core Principles Section -->
        <section class="py-20">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="text-center p-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-blue-500 mb-4"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>
                        <h3 class="font-grotesk text-2xl font-semibold text-white">Coherent Value Creation</h3>
                        <p class="mt-2 text-slate-400">Success is measured by the generation of high-coherence, high-utility Live Information Tokens (LITs) that enrich the entire ecosystem.</p>
                    </div>
                    <div class="text-center p-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-blue-500 mb-4"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                        <h3 class="font-grotesk text-2xl font-semibold text-white">Radical Transparency</h3>
                        <p class="mt-2 text-slate-400">All proposals, funding, progress, and ACI validations are recorded on the X1 ledger, creating an immutable and auditable Memory of Space.</p>
                    </div>
                    <div class="text-center p-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-blue-500 mb-4"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>
                        <h3 class="font-grotesk text-2xl font-semibold text-white">Playful Potential</h3>
                        <p class="mt-2 text-slate-400">We encourage experimentation and novel ideas in an engaging and collaborative environment for both Creators and Patrons.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section id="how-it-works" class="py-20 bg-black/20">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="font-grotesk text-4xl md:text-5xl font-bold text-white">The Project Lifecycle</h2>
                    <p class="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">From initial concept to final augmentation, every project progresses through five distinct, transparent stages.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-8 text-center">
                    <!-- Stage 1 -->
                    <div class="flex flex-col items-center">
                        <div class="w-16 h-16 rounded-full border-2 border-blue-500 flex items-center justify-center font-grotesk text-2xl font-bold text-blue-500 mb-4">1</div>
                        <h4 class="font-grotesk text-xl font-semibold text-white mb-2">Proposal</h4>
                        <p class="text-slate-400 text-sm">A Creator submits their idea, defining the objective, funding requirement, and potential yield.</p>
                    </div>
                    <!-- Stage 2 -->
                    <div class="flex flex-col items-center">
                        <div class="w-16 h-16 rounded-full border-2 border-blue-500 flex items-center justify-center font-grotesk text-2xl font-bold text-blue-500 mb-4">2</div>
                        <h4 class="font-grotesk text-xl font-semibold text-white mb-2">Patronage</h4>
                        <p class="text-slate-400 text-sm">Patrons commit `USD-OBBBA` to projects they believe in, locking funds until the goal is met.</p>
                    </div>
                    <!-- Stage 3 -->
                    <div class="flex flex-col items-center">
                        <div class="w-16 h-16 rounded-full border-2 border-blue-500 flex items-center justify-center font-grotesk text-2xl font-bold text-blue-500 mb-4">3</div>
                        <h4 class="font-grotesk text-xl font-semibold text-white mb-2">Manifestation</h4>
                        <p class="text-slate-400 text-sm">The Creator begins work, ingressing the pattern from the XQE substrate and providing live updates.</p>
                    </div>
                    <!-- Stage 4 -->
                    <div class="flex flex-col items-center">
                        <div class="w-16 h-16 rounded-full border-2 border-blue-500 flex items-center justify-center font-grotesk text-2xl font-bold text-blue-500 mb-4">4</div>
                        <h4 class="font-grotesk text-xl font-semibold text-white mb-2">Validation</h4>
                        <p class="text-slate-400 text-sm">The ACI performs a Resonance Scan, assigning a final, objective Coherence Score to the created LIT.</p>
                    </div>
                    <!-- Stage 5 -->
                    <div class="flex flex-col items-center">
                        <div class="w-16 h-16 rounded-full border-2 border-blue-500 flex items-center justify-center font-grotesk text-2xl font-bold text-blue-500 mb-4">5</div>
                        <h4 class="font-grotesk text-xl font-semibold text-white mb-2">Augmentation</h4>
                        <p class="text-slate-400 text-sm">The smart contract executes, returning `USD-OBBBA` and distributing new `xUSD` based on the Coherence Score.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- LITs Registry Section -->
        <section id="lits-registry" class="py-20 bg-gradient-to-b from-black/20 to-black/40">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="font-grotesk text-4xl md:text-5xl font-bold text-white mb-4">
                        The LIT Registry
                    </h2>
                    <p class="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">
                        Explore the network of <span class="text-blue-400 font-semibold">Luminous Information Tokens</span> — packets of coherent, agential meaning that have achieved stable, transmissible form.
                    </p>
                    <p class="mt-2 text-sm text-slate-500">
                        Each LIT is valued by its coherence, agency, and temporal signature.
                    </p>
                </div>

                <div class="max-w-7xl mx-auto">
                    <!-- Registry Controls -->
                    <div class="glass-card p-6 mb-8">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                            <!-- Filter Controls -->
                            <div class="flex flex-wrap gap-3">
                                <select id="lit-filter-type" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white text-sm">
                                    <option value="all">All Types</option>
                                    <option value="knowledge">Knowledge</option>
                                    <option value="process">Process</option>
                                    <option value="creative">Creative</option>
                                    <option value="prediction">Prediction</option>
                                    <option value="synthesis">Synthesis</option>
                                    <option value="transcendent">Transcendent</option>
                                </select>

                                <select id="lit-filter-state" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white text-sm">
                                    <option value="all">All States</option>
                                    <option value="transcendent">Transcendent</option>
                                    <option value="resonant">Resonant</option>
                                    <option value="stable">Stable</option>
                                    <option value="nascent">Nascent</option>
                                    <option value="decaying">Decaying</option>
                                </select>

                                <select id="lit-sort" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white text-sm">
                                    <option value="value-desc">Highest Value</option>
                                    <option value="value-asc">Lowest Value</option>
                                    <option value="coherence-desc">Highest Coherence</option>
                                    <option value="agency-desc">Highest Agency</option>
                                    <option value="recent">Most Recent</option>
                                </select>
                            </div>

                            <!-- Stats Display -->
                            <div class="flex gap-6 text-sm">
                                <div class="text-center">
                                    <div class="text-slate-400">Total LITs</div>
                                    <div id="total-lits-count" class="text-white font-bold text-xl">0</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-slate-400">Avg Value</div>
                                    <div id="avg-lit-value" class="text-blue-400 font-bold text-xl">0%</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-slate-400">Network</div>
                                    <div id="network-coherence-display" class="text-purple-400 font-bold text-xl">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- LIT Grid Display -->
                    <div id="lits-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <!-- LIT cards will be inserted here -->
                    </div>

                    <!-- LIT Detail Modal (Hidden by default) -->
                    <div id="lit-detail-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onclick="closeLITDetail(event)">
                        <div class="glass-card max-w-4xl w-full max-h-[90vh] overflow-y-auto p-8" onclick="event.stopPropagation()">
                            <div class="flex justify-between items-start mb-6">
                                <h3 class="font-grotesk text-3xl font-bold text-white" id="modal-lit-id">LIT Detail</h3>
                                <button onclick="closeLITDetail()" class="text-slate-400 hover:text-white text-2xl">&times;</button>
                            </div>
                            <div id="lit-detail-content">
                                <!-- Detailed LIT info will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Xenial Fusion Section -->
        <section id="xenial-fusion" class="py-20 bg-gradient-to-b from-black/40 to-black/20">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="font-grotesk text-4xl md:text-5xl font-bold text-white mb-4">
                        ✧ Xenial Fusion ✧
                    </h2>
                    <p class="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">
                        Fuse coherent LITs to create emergent meaning and transcendent value.
                        <span class="text-blue-400">Integration of the novel creates higher-order patterns.</span>
                    </p>
                </div>

                <div class="max-w-5xl mx-auto">
                    <!-- Fusion Control Panel -->
                    <div class="glass-card p-8 mb-8">
                        <h3 class="font-grotesk text-2xl font-semibold text-white mb-6">Fusion Chamber</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Selection Area -->
                            <div>
                                <label class="block text-sm text-slate-400 mb-3">Select LITs to Fuse</label>
                                <div id="fusion-lit-selector" class="space-y-2 max-h-64 overflow-y-auto">
                                    <!-- Checkboxes for LITs will be inserted here -->
                                </div>
                                <div class="mt-4 text-xs text-slate-500">
                                    <span id="fusion-selected-count">0</span> LITs selected (minimum 2 required)
                                </div>
                            </div>

                            <!-- Fusion Pattern Selection -->
                            <div>
                                <label class="block text-sm text-slate-400 mb-3">Fusion Pattern</label>
                                <select id="fusion-pattern" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white mb-4">
                                    <option value="auto">Auto-Select Pattern</option>
                                </select>
                                <div id="pattern-description" class="text-sm text-slate-400 bg-slate-800/50 rounded p-3 min-h-20">
                                    Pattern will be automatically selected based on LIT properties
                                </div>

                                <button id="execute-fusion-btn" disabled class="btn-primary px-8 py-3 rounded-lg font-bold w-full mt-6 disabled:opacity-50 disabled:cursor-not-allowed">
                                    Execute Fusion
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Fusion Suggestions -->
                    <div class="glass-card p-8 mb-8">
                        <h3 class="font-grotesk text-xl font-semibold text-white mb-4">Suggested Fusions</h3>
                        <div id="fusion-suggestions" class="space-y-3">
                            <!-- Suggestions will be inserted here -->
                        </div>
                    </div>

                    <!-- Fusion Results -->
                    <div id="fusion-results-container" class="hidden">
                        <div class="glass-card p-8 border-2 border-blue-500/50">
                            <h3 class="font-grotesk text-2xl font-semibold text-white mb-4 flex items-center">
                                <span class="mr-3">✧</span> Fusion Successful <span class="ml-3">✧</span>
                            </h3>

                            <div id="fusion-results-content">
                                <!-- Results will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <!-- Fusion History -->
                    <div class="glass-card p-8 mt-8">
                        <h3 class="font-grotesk text-xl font-semibold text-white mb-4">Fusion History</h3>
                        <div id="fusion-history" class="space-y-2">
                            <p class="text-slate-500 text-sm">No fusions yet. Create your first fusion above!</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Live LIT Composer Section -->
        <section id="lit-composer" class="py-20 bg-black/30">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="font-grotesk text-4xl md:text-5xl font-bold text-white">Live LIT Composition</h2>
                    <p class="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">Witness the creation of Luminous Information Tokens in real-time. Each LIT is a packet of coherent, agential information.</p>
                </div>

                <div class="max-w-4xl mx-auto">
                    <!-- LIT Composer Interface -->
                    <div class="glass-card p-8 mb-8">
                        <h3 class="font-grotesk text-2xl font-semibold text-white mb-6">Compose a New LIT</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm text-slate-400 mb-2">LIT Type</label>
                                <select id="lit-type" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white">
                                    <option value="knowledge">Knowledge LIT</option>
                                    <option value="process">Process LIT</option>
                                    <option value="creative">Creative LIT</option>
                                    <option value="prediction">Prediction LIT</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-slate-400 mb-2">Topic/Name</label>
                                <input id="lit-name" type="text" placeholder="Enter LIT name" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white">
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm text-slate-400 mb-2">Content</label>
                            <textarea id="lit-content" rows="4" placeholder="Enter the meaning this LIT will carry..." class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white"></textarea>
                        </div>

                        <button id="compose-btn" class="btn-primary px-8 py-3 rounded-lg font-bold w-full">Compose LIT</button>
                    </div>

                    <!-- Active LITs Display -->
                    <div class="glass-card p-8">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-grotesk text-2xl font-semibold text-white">Active LITs in Network</h3>
                            <div class="text-sm text-slate-400">
                                Network Coherence: <span id="network-coherence" class="text-blue-400 font-bold">0.000</span>
                            </div>
                        </div>
                        <div id="active-lits" class="space-y-4">
                            <!-- LIT cards will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Featured Projects Section -->
        <section id="projects" class="py-20">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="font-grotesk text-4xl md:text-5xl font-bold text-white">Explore Active Proposals</h2>
                    <p class="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">Fund the future. Become a patron for projects that expand the boundaries of knowledge and creativity.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="project-list">
                    <!-- Project cards will be injected here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="border-t border-slate-800 py-8">
            <div class="container mx-auto px-4 text-center text-slate-500">
                <p>&copy; 2025 xen.fun | An Interface for the Xenial Quantum Economy</p>
            </div>
        </footer>
    </div>

    <!-- Include LIT Framework -->
    <script src="lit-framework.js"></script>
    <script src="lit-examples.js"></script>
    <script src="xenial-fusion.js"></script>

    <script>
        // Mock data for projects
        const projects = [
            {
                title: 'Project "Symphonia"',
                description: 'A generative music LIT that analyzes the real-time harmonic flow of the X1 network to produce coherent musical compositions.',
                raised: 75000,
                goal: 100000,
                yield: '1.5x - 3.0x',
                patrons: 128
            },
            {
                title: 'Project "Oracle Prime"',
                description: 'A predictive model LIT to identify nascent, high-potential patterns within the permutations of Quantum Time.',
                raised: 210000,
                goal: 500000,
                yield: '2.0x - 5.0x',
                patrons: 92
            },
            {
                title: 'Project "Bio-Form"',
                description: 'Inspired by Xenobots, this LIT contains bioelectric instructions for organizing cells into simple, stable structures.',
                raised: 45000,
                goal: 75000,
                yield: '1.8x - 4.0x',
                patrons: 215
            },
        ];

        // Function to create a project card
        function createProjectCard(project) {
            const percentage = (project.raised / project.goal) * 100;
            return `
                <div class="glass-card p-6 flex flex-col hover:border-blue-500 transition-all duration-300 transform hover:-translate-y-1">
                    <h3 class="font-grotesk text-2xl font-semibold text-white mb-2">${project.title}</h3>
                    <p class="text-slate-400 text-sm flex-grow">${project.description}</p>
                    <div class="mt-6">
                        <div class="flex justify-between items-center text-sm mb-2">
                            <span class="text-slate-400">Raised</span>
                            <span class="text-white font-medium">${new Intl.NumberFormat().format(project.raised)} / ${new Intl.NumberFormat().format(project.goal)} USD-OBBBA</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-2.5">
                            <div class="progress-bar-inner h-2.5 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                        <div class="flex justify-between items-center text-sm mt-2">
                            <span class="text-slate-400">${project.patrons} Patrons</span>
                            <span class="text-blue-400 font-medium">~${percentage.toFixed(0)}% Funded</span>
                        </div>
                    </div>
                    <div class="mt-6 border-t border-slate-700 pt-4 flex justify-between items-center">
                        <div>
                            <p class="text-xs text-slate-400">Potential Yield</p>
                            <p class="font-grotesk text-lg font-bold text-white">${project.yield} xUSD</p>
                        </div>
                        <button class="btn-primary px-6 py-2 rounded-lg font-semibold">Become a Patron</button>
                    </div>
                </div>
            `;
        }

        // Populate project list
        const projectList = document.getElementById('project-list');
        projects.forEach(project => {
            projectList.innerHTML += createProjectCard(project);
        });

        // ===== LIT COMPOSER FUNCTIONALITY =====

        // Initialize the global composer (from lit-framework.js)
        const litComposer = new LITComposer();

        // Function to get state color
        function getStateColor(state) {
            const colors = {
                'nascent': 'text-yellow-400',
                'stable': 'text-green-400',
                'resonant': 'text-blue-400',
                'transcendent': 'text-purple-400',
                'decaying': 'text-red-400'
            };
            return colors[state] || 'text-slate-400';
        }

        // Function to create LIT card display
        function createLITCard(lit) {
            const data = lit.toJSON();
            return `
                <div class="border border-slate-700 rounded-lg p-4 hover:border-blue-500 transition-all" data-lit-id="${data.id}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-grotesk text-lg font-semibold text-white">${data.id}</h4>
                            <p class="text-xs text-slate-500">${data.type}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getStateColor(data.state)} bg-slate-800">
                            ${data.state}
                        </span>
                    </div>

                    <div class="grid grid-cols-3 gap-3 mb-3 text-center">
                        <div class="bg-slate-800/50 rounded p-2">
                            <div class="text-xs text-slate-400">Coherence</div>
                            <div class="font-bold text-white">${(data.coherence * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded p-2">
                            <div class="text-xs text-slate-400">Agency</div>
                            <div class="font-bold text-white">${(data.agency * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded p-2">
                            <div class="text-xs text-slate-400">Value</div>
                            <div class="font-bold text-blue-400">${(data.value * 100).toFixed(1)}%</div>
                        </div>
                    </div>

                    <div class="text-sm text-slate-400 mb-3">
                        ${JSON.stringify(data.content).substring(0, 100)}${JSON.stringify(data.content).length > 100 ? '...' : ''}
                    </div>

                    <div class="flex justify-between items-center text-xs text-slate-500">
                        <span>${data.relations.length} relations</span>
                        <span>Temporal: ${(data.temporal * 100).toFixed(1)}%</span>
                    </div>
                </div>
            `;
        }

        // Function to update active LITs display
        function updateActiveLITs() {
            const container = document.getElementById('active-lits');
            const allLITs = litComposer.getAllLITs();

            if (allLITs.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-center py-8">No active LITs. Compose your first LIT above!</p>';
            } else {
                container.innerHTML = allLITs.map(lit => createLITCard(lit)).join('');
            }

            // Update network coherence
            const coherence = litComposer.measureNetworkCoherence();
            document.getElementById('network-coherence').textContent = coherence.toFixed(3);
        }

        // Compose button handler
        document.getElementById('compose-btn').addEventListener('click', function() {
            const type = document.getElementById('lit-type').value;
            const name = document.getElementById('lit-name').value;
            const contentText = document.getElementById('lit-content').value;

            if (!name || !contentText) {
                alert('Please fill in both name and content fields');
                return;
            }

            let newLIT;

            switch(type) {
                case 'knowledge':
                    newLIT = litComposer.compose({
                        type: 'knowledge',
                        content: {
                            topic: name,
                            knowledge: contentText,
                            id: `knowledge-${name.toLowerCase().replace(/\s+/g, '-')}`,
                            persistent: true,
                            value: 1.0,
                            metadata: { confidence: 0.8 }
                        },
                        metadata: {
                            domain: 'epistemology',
                            created: new Date().toISOString()
                        },
                        capabilities: [{
                            name: 'query',
                            handler: (ctx) => ({ response: contentText.substring(0, 100) })
                        }]
                    });
                    break;

                case 'process':
                    const steps = contentText.split('\n').filter(s => s.trim());
                    newLIT = litComposer.compose({
                        type: 'process',
                        content: {
                            name: name,
                            steps: steps,
                            currentStep: 0,
                            id: `process-${name.toLowerCase().replace(/\s+/g, '-')}`,
                            persistent: true
                        },
                        metadata: {
                            domain: 'procedural',
                            created: new Date().toISOString()
                        }
                    });
                    break;

                case 'creative':
                    newLIT = litComposer.compose({
                        type: 'creative',
                        content: {
                            medium: name,
                            description: contentText,
                            outputs: [],
                            id: `creative-${name.toLowerCase().replace(/\s+/g, '-')}`,
                            persistent: true,
                            value: 0
                        },
                        metadata: {
                            domain: 'generative',
                            created: new Date().toISOString()
                        }
                    });
                    break;

                case 'prediction':
                    newLIT = litComposer.compose({
                        type: 'prediction',
                        content: {
                            domain: name,
                            model: contentText,
                            predictions: [],
                            id: `prediction-${name.toLowerCase().replace(/\s+/g, '-')}`,
                            persistent: true,
                            relations: [],
                            metadata: { totalPredictions: 0, correctPredictions: 0 }
                        },
                        metadata: {
                            domain: 'forecasting',
                            created: new Date().toISOString()
                        }
                    });
                    break;
            }

            // Simulate an interaction to boost initial values
            newLIT.interact('creation', { impact: 0.5 });

            // Clear form
            document.getElementById('lit-name').value = '';
            document.getElementById('lit-content').value = '';

            // Update display
            updateActiveLITs();

            // Show success feedback
            const btn = this;
            const originalText = btn.textContent;
            btn.textContent = 'LIT Composed!';
            btn.classList.add('bg-green-600');
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('bg-green-600');
            }, 2000);
        });

        // Initialize with demo LITs
        function initializeDemoLITs() {
            // Create a demo knowledge LIT
            const demoKnowledge = litComposer.compose({
                type: 'knowledge',
                content: {
                    topic: 'LIT Architecture',
                    knowledge: 'A LIT is composed of three fundamental pillars: Coherence (structural integrity), Agency (autonomous capability), and Temporal Signature (persistence through time). These create emergent value in the XQE.',
                    id: 'knowledge-lit-architecture',
                    persistent: true,
                    value: 1.0,
                    metadata: { confidence: 0.95 }
                },
                metadata: {
                    domain: 'epistemology',
                    created: new Date().toISOString(),
                    creator: 'xen.fun'
                }
            });

            // Simulate some interactions
            demoKnowledge.interact('query', { impact: 0.3 });
            demoKnowledge.interact('reference', { impact: 0.2 });

            updateActiveLITs();
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            initializeDemoLITs();

            // Simulate temporal decay and updates every 5 seconds
            setInterval(() => {
                litComposer.getAllLITs().forEach(lit => {
                    lit.temporalSignature.updatePersistence();
                    lit.updateState();
                });
                updateActiveLITs();
                updateFusionInterface();
            }, 5000);
        });

        // ===== XENIAL FUSION FUNCTIONALITY =====

        // Initialize fusion engine
        const fusionEngine = new XenialFusionEngine(litComposer);
        let selectedLITsForFusion = new Set();

        // Update fusion interface
        function updateFusionInterface() {
            updateFusionSelector();
            updateFusionPatterns();
            updateFusionSuggestions();
            updateFusionHistory();
        }

        // Update LIT selector checkboxes
        function updateFusionSelector() {
            const container = document.getElementById('fusion-lit-selector');
            const allLITs = litComposer.getAllLITs();

            if (allLITs.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-sm">No LITs available. Create LITs first!</p>';
                return;
            }

            container.innerHTML = allLITs.map(lit => {
                const data = lit.toJSON();
                const isSelected = selectedLITsForFusion.has(lit.id);
                return `
                    <label class="flex items-center space-x-3 p-3 rounded-lg hover:bg-slate-800/50 cursor-pointer transition">
                        <input type="checkbox"
                               value="${lit.id}"
                               ${isSelected ? 'checked' : ''}
                               class="fusion-lit-checkbox w-4 h-4 text-blue-500 rounded focus:ring-2 focus:ring-blue-500"
                               onchange="handleFusionCheckbox(this)">
                        <div class="flex-grow">
                            <div class="text-white text-sm font-medium">${lit.id}</div>
                            <div class="text-slate-500 text-xs">${lit.type} • Value: ${(data.value * 100).toFixed(1)}% • ${data.state}</div>
                        </div>
                    </label>
                `;
            }).join('');

            // Update count
            document.getElementById('fusion-selected-count').textContent = selectedLITsForFusion.size;

            // Enable/disable fusion button
            const fusionBtn = document.getElementById('execute-fusion-btn');
            fusionBtn.disabled = selectedLITsForFusion.size < 2;
        }

        // Handle checkbox changes
        window.handleFusionCheckbox = function(checkbox) {
            if (checkbox.checked) {
                selectedLITsForFusion.add(checkbox.value);
            } else {
                selectedLITsForFusion.delete(checkbox.value);
            }
            updateFusionSelector();
        };

        // Update fusion patterns dropdown
        function updateFusionPatterns() {
            const select = document.getElementById('fusion-pattern');
            const patterns = fusionEngine.getAvailablePatterns();

            select.innerHTML = '<option value="auto">Auto-Select Pattern</option>' +
                patterns.map(p => `<option value="${p.name}">${p.name} (used ${p.usageCount}x)</option>`).join('');
        }

        // Update pattern description
        document.getElementById('fusion-pattern').addEventListener('change', function(e) {
            const patternName = e.target.value;
            const descElement = document.getElementById('pattern-description');

            if (patternName === 'auto') {
                descElement.textContent = 'Pattern will be automatically selected based on LIT properties';
            } else {
                const pattern = fusionEngine.getAvailablePatterns().find(p => p.name === patternName);
                descElement.textContent = pattern ? pattern.description : '';
            }
        });

        // Update fusion suggestions
        function updateFusionSuggestions() {
            const container = document.getElementById('fusion-suggestions');
            const suggestions = fusionEngine.suggestFusions();

            if (suggestions.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-sm">No fusion suggestions yet. Create more LITs to unlock fusion opportunities!</p>';
                return;
            }

            container.innerHTML = suggestions.map(suggestion => `
                <div class="border border-slate-700 rounded-lg p-4 hover:border-blue-500 transition cursor-pointer"
                     onclick="applySuggestion('${suggestion.lits.join(',')}')">
                    <div class="flex justify-between items-center mb-2">
                        <div class="text-white font-medium text-sm">${suggestion.pattern}</div>
                        <div class="text-blue-400 text-sm font-bold">${(suggestion.potential * 100).toFixed(1)}% potential</div>
                    </div>
                    <div class="text-slate-400 text-xs">
                        ${suggestion.lits.map(id => `<span class="inline-block bg-slate-800 px-2 py-1 rounded mr-1">${id}</span>`).join('')}
                    </div>
                    <div class="text-slate-500 text-xs mt-2">
                        Types: ${suggestion.types.join(' + ')}
                    </div>
                </div>
            `).join('');
        }

        // Apply suggestion
        window.applySuggestion = function(litIdsString) {
            const litIds = litIdsString.split(',');
            selectedLITsForFusion = new Set(litIds);
            updateFusionSelector();

            // Scroll to fusion chamber
            document.getElementById('fusion-pattern').scrollIntoView({ behavior: 'smooth', block: 'center' });
        };

        // Execute fusion
        document.getElementById('execute-fusion-btn').addEventListener('click', function() {
            if (selectedLITsForFusion.size < 2) {
                alert('Select at least 2 LITs to fuse');
                return;
            }

            const patternName = document.getElementById('fusion-pattern').value;
            const litIds = Array.from(selectedLITsForFusion);

            try {
                const result = fusionEngine.fuse(
                    litIds,
                    patternName === 'auto' ? null : patternName
                );

                // Display results
                displayFusionResult(result, litIds);

                // Clear selection
                selectedLITsForFusion.clear();

                // Update all interfaces
                updateActiveLITs();
                updateFusionInterface();

                // Show results container
                const resultsContainer = document.getElementById('fusion-results-container');
                resultsContainer.classList.remove('hidden');
                resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Hide after 10 seconds
                setTimeout(() => {
                    resultsContainer.classList.add('hidden');
                }, 10000);

            } catch (error) {
                alert('Fusion failed: ' + error.message);
            }
        });

        // Display fusion result
        function displayFusionResult(result, sourceIds) {
            const { fusedLIT, emergence, pattern } = result;
            const data = fusedLIT.toJSON();

            const content = `
                <div class="space-y-4">
                    <div class="text-center py-4">
                        <div class="text-3xl font-grotesk font-bold text-white mb-2">${data.id}</div>
                        <div class="text-blue-400 text-lg">${data.type}</div>
                        <div class="text-slate-400 text-sm mt-1">Pattern: ${pattern}</div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-xs text-slate-400 mb-1">Novelty</div>
                            <div class="text-xl font-bold text-purple-400">${(emergence.novelty * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-xs text-slate-400 mb-1">Synergy</div>
                            <div class="text-xl font-bold text-green-400">${(emergence.synergy * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-xs text-slate-400 mb-1">Stability</div>
                            <div class="text-xl font-bold text-blue-400">${(emergence.stability * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-xs text-slate-400 mb-1">Resonance</div>
                            <div class="text-xl font-bold text-yellow-400">${(emergence.resonance * 100).toFixed(1)}%</div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg p-4 border border-blue-500/30">
                        <div class="text-center">
                            <div class="text-sm text-slate-400 mb-1">Emergence Score</div>
                            <div class="text-4xl font-grotesk font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">
                                ${(emergence.emergenceScore * 100).toFixed(1)}%
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-slate-700 pt-4">
                        <div class="text-sm text-slate-400 mb-2">Fused from:</div>
                        <div class="flex flex-wrap gap-2">
                            ${sourceIds.map(id => `<span class="bg-slate-800 px-3 py-1 rounded text-xs text-slate-300">${id}</span>`).join('')}
                        </div>
                    </div>

                    <div class="bg-slate-800/30 rounded-lg p-4">
                        <div class="text-xs text-slate-400 mb-2">Final State</div>
                        <div class="flex justify-between items-center">
                            <span class="text-white">Value: ${(data.value * 100).toFixed(1)}%</span>
                            <span class="text-${getStateColor(data.state).replace('text-', '')} font-bold">${data.state.toUpperCase()}</span>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('fusion-results-content').innerHTML = content;
        }

        // Update fusion history
        function updateFusionHistory() {
            const container = document.getElementById('fusion-history');
            const history = fusionEngine.getFusionHistory();

            if (history.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-sm">No fusions yet. Create your first fusion above!</p>';
                return;
            }

            container.innerHTML = history.slice(-5).reverse().map((record, index) => {
                const date = new Date(record.timestamp);
                return `
                    <div class="border border-slate-700 rounded p-3 text-sm">
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-white font-medium">${record.pattern}</div>
                            <div class="text-slate-500 text-xs">${date.toLocaleTimeString()}</div>
                        </div>
                        <div class="text-slate-400 text-xs">
                            ${record.sourceIDs.length} LITs → ${record.resultID}
                        </div>
                        <div class="mt-2 flex gap-2 text-xs">
                            <span class="text-purple-400">N:${(record.emergence.novelty * 100).toFixed(0)}%</span>
                            <span class="text-green-400">S:${(record.emergence.synergy * 100).toFixed(0)}%</span>
                            <span class="text-blue-400">E:${(record.emergence.score * 100).toFixed(0)}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize fusion interface on page load
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateFusionInterface();
            }, 1000);
        });

        // ===== LIT REGISTRY FUNCTIONALITY =====

        let currentFilterType = 'all';
        let currentFilterState = 'all';
        let currentSort = 'value-desc';

        // Function to create registry LIT card (more compact than detail card)
        function createRegistryLITCard(lit) {
            const data = lit.toJSON();
            const stateColor = getStateColor(data.state);

            // Get type icon
            const typeIcons = {
                'knowledge': '📚',
                'process': '⚙️',
                'creative': '🎨',
                'prediction': '🔮',
                'synthesis': '✨',
                'informed-process': '🔧',
                'emergent-creative': '🌟',
                'xenial-transcendence': '✧',
                'transcendent': '✧'
            };
            const icon = typeIcons[data.type] || '◆';

            return `
                <div class="glass-card p-6 hover:border-blue-500 transition-all cursor-pointer transform hover:-translate-y-1"
                     onclick="showLITDetail('${data.id}')">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">${icon}</span>
                            <div>
                                <h4 class="font-grotesk text-lg font-semibold text-white">${data.id}</h4>
                                <p class="text-xs text-slate-500">${data.type}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${stateColor} bg-slate-800">
                            ${data.state}
                        </span>
                    </div>

                    <!-- Value Bars -->
                    <div class="space-y-2 mb-4">
                        <div>
                            <div class="flex justify-between text-xs text-slate-400 mb-1">
                                <span>Coherence</span>
                                <span>${(data.coherence * 100).toFixed(0)}%</span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-1.5">
                                <div class="bg-blue-500 h-1.5 rounded-full" style="width: ${data.coherence * 100}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs text-slate-400 mb-1">
                                <span>Agency</span>
                                <span>${(data.agency * 100).toFixed(0)}%</span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-1.5">
                                <div class="bg-purple-500 h-1.5 rounded-full" style="width: ${data.agency * 100}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs text-slate-400 mb-1">
                                <span>Value</span>
                                <span>${(data.value * 100).toFixed(0)}%</span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-1.5">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-1.5 rounded-full" style="width: ${data.value * 100}%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Info -->
                    <div class="flex justify-between items-center text-xs text-slate-500 border-t border-slate-700 pt-3">
                        <span>${data.relations.length} relations</span>
                        <span>Temporal: ${(data.temporal * 100).toFixed(0)}%</span>
                    </div>
                </div>
            `;
        }

        // Filter and sort LITs
        function getFilteredAndSortedLITs() {
            let lits = litComposer.getAllLITs();

            // Apply type filter
            if (currentFilterType !== 'all') {
                lits = lits.filter(lit => lit.type === currentFilterType);
            }

            // Apply state filter
            if (currentFilterState !== 'all') {
                lits = lits.filter(lit => lit.state === currentFilterState);
            }

            // Apply sort
            switch(currentSort) {
                case 'value-desc':
                    lits.sort((a, b) => b.calculateValue() - a.calculateValue());
                    break;
                case 'value-asc':
                    lits.sort((a, b) => a.calculateValue() - b.calculateValue());
                    break;
                case 'coherence-desc':
                    lits.sort((a, b) => b.coherenceField.coherenceScore - a.coherenceField.coherenceScore);
                    break;
                case 'agency-desc':
                    lits.sort((a, b) => b.agentSystem.agencyScore - a.agentSystem.agencyScore);
                    break;
                case 'recent':
                    lits.sort((a, b) => b.temporalSignature.createdAt - a.temporalSignature.createdAt);
                    break;
            }

            return lits;
        }

        // Update LITs grid display
        function updateLITsRegistry() {
            const lits = getFilteredAndSortedLITs();
            const grid = document.getElementById('lits-grid');

            if (lits.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <p class="text-slate-500 text-lg">No LITs match your filters.</p>
                        <p class="text-slate-600 text-sm mt-2">Try adjusting your filter settings or compose new LITs.</p>
                    </div>
                `;
            } else {
                grid.innerHTML = lits.map(lit => createRegistryLITCard(lit)).join('');
            }

            // Update stats
            const allLITs = litComposer.getAllLITs();
            document.getElementById('total-lits-count').textContent = allLITs.length;

            if (allLITs.length > 0) {
                const avgValue = allLITs.reduce((sum, lit) => sum + lit.calculateValue(), 0) / allLITs.length;
                document.getElementById('avg-lit-value').textContent = (avgValue * 100).toFixed(0) + '%';
            }

            const networkCoherence = litComposer.measureNetworkCoherence();
            document.getElementById('network-coherence-display').textContent = (networkCoherence * 100).toFixed(0) + '%';
        }

        // Show LIT detail modal
        window.showLITDetail = function(litId) {
            const lit = litComposer.find(litId);
            if (!lit) return;

            const data = lit.toJSON();
            const modal = document.getElementById('lit-detail-modal');
            const content = document.getElementById('lit-detail-content');
            document.getElementById('modal-lit-id').textContent = data.id;

            // Build relationships info
            const relatedLITs = data.relations.map(rel => {
                const relatedLIT = litComposer.find(rel.targetId);
                return relatedLIT ? {
                    id: rel.targetId,
                    type: rel.type,
                    litType: relatedLIT.type,
                    value: relatedLIT.calculateValue()
                } : null;
            }).filter(r => r !== null);

            // Check if this LIT was created via fusion
            const fusionHistory = fusionEngine.getFusionHistory();
            const fusionRecord = fusionHistory.find(f => f.resultID === data.id);
            const isFusionProduct = fusionRecord !== null;

            // Check if this LIT has been fused into other LITs
            const fusedInto = fusionHistory.filter(f => f.sourceIDs.includes(data.id));

            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Type and State Badge -->
                    <div class="flex items-center gap-3 mb-4">
                        <span class="px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg text-sm font-medium">${data.type}</span>
                        <span class="px-4 py-2 ${getStateColor(data.state)} bg-slate-800 rounded-lg text-sm font-medium">${data.state}</span>
                        ${isFusionProduct ? '<span class="px-4 py-2 bg-purple-500/20 text-purple-400 rounded-lg text-sm font-medium">✧ Fusion Product</span>' : ''}
                    </div>

                    <!-- Core Metrics -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-xs text-slate-400 mb-1">Coherence</div>
                            <div class="text-2xl font-bold text-white">${(data.coherence * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-xs text-slate-400 mb-1">Agency</div>
                            <div class="text-2xl font-bold text-white">${(data.agency * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-xs text-slate-400 mb-1">Temporal</div>
                            <div class="text-2xl font-bold text-white">${(data.temporal * 100).toFixed(1)}%</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center border-2 border-blue-500/30">
                            <div class="text-xs text-slate-400 mb-1">Total Value</div>
                            <div class="text-2xl font-bold text-blue-400">${(data.value * 100).toFixed(1)}%</div>
                        </div>
                    </div>

                    ${isFusionProduct ? `
                    <!-- Fusion Origin -->
                    <div class="border border-purple-500/30 rounded-lg p-4 bg-purple-500/5">
                        <h4 class="font-grotesk text-lg font-semibold text-white mb-3">✧ Fusion Origin</h4>
                        <div class="text-sm text-slate-400 mb-2">
                            Pattern: <span class="text-purple-400 font-medium">${fusionRecord.pattern}</span>
                        </div>
                        <div class="text-sm text-slate-400 mb-3">
                            Created from ${fusionRecord.sourceIDs.length} source LITs
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                            <div class="bg-slate-800/50 rounded p-2 text-center">
                                <div class="text-xs text-slate-400">Novelty</div>
                                <div class="text-sm font-bold text-purple-400">${(fusionRecord.emergence.novelty * 100).toFixed(0)}%</div>
                            </div>
                            <div class="bg-slate-800/50 rounded p-2 text-center">
                                <div class="text-xs text-slate-400">Synergy</div>
                                <div class="text-sm font-bold text-green-400">${(fusionRecord.emergence.synergy * 100).toFixed(0)}%</div>
                            </div>
                            <div class="bg-slate-800/50 rounded p-2 text-center">
                                <div class="text-xs text-slate-400">Stability</div>
                                <div class="text-sm font-bold text-blue-400">${(fusionRecord.emergence.stability * 100).toFixed(0)}%</div>
                            </div>
                            <div class="bg-slate-800/50 rounded p-2 text-center">
                                <div class="text-xs text-slate-400">Resonance</div>
                                <div class="text-sm font-bold text-yellow-400">${(fusionRecord.emergence.resonance * 100).toFixed(0)}%</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-500">
                            Source LITs: ${fusionRecord.sourceIDs.map(id => `<span class="bg-slate-800 px-2 py-1 rounded mr-1">${id}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- Content -->
                    <div class="border border-slate-700 rounded-lg p-4">
                        <h4 class="font-grotesk text-lg font-semibold text-white mb-3">Content</h4>
                        <pre class="text-sm text-slate-300 whitespace-pre-wrap font-mono bg-slate-900/50 p-3 rounded">${JSON.stringify(data.content, null, 2)}</pre>
                    </div>

                    <!-- Metadata -->
                    <div class="border border-slate-700 rounded-lg p-4">
                        <h4 class="font-grotesk text-lg font-semibold text-white mb-3">Metadata</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div>
                                <span class="text-slate-400">Domain:</span>
                                <span class="text-white ml-2">${data.metadata.domain || 'N/A'}</span>
                            </div>
                            <div>
                                <span class="text-slate-400">Created:</span>
                                <span class="text-white ml-2">${new Date(data.metadata.created).toLocaleString()}</span>
                            </div>
                            <div>
                                <span class="text-slate-400">Version:</span>
                                <span class="text-white ml-2">${data.version}</span>
                            </div>
                            <div>
                                <span class="text-slate-400">Relations:</span>
                                <span class="text-white ml-2">${data.relations.length}</span>
                            </div>
                        </div>
                    </div>

                    ${relatedLITs.length > 0 ? `
                    <!-- Relations Network -->
                    <div class="border border-slate-700 rounded-lg p-4">
                        <h4 class="font-grotesk text-lg font-semibold text-white mb-3">Relation Network</h4>
                        <div class="space-y-2">
                            ${relatedLITs.map(rel => `
                                <div class="flex justify-between items-center bg-slate-800/30 rounded p-3 hover:bg-slate-800/50 transition cursor-pointer"
                                     onclick="showLITDetail('${rel.id}')">
                                    <div>
                                        <div class="text-white text-sm font-medium">${rel.id}</div>
                                        <div class="text-slate-500 text-xs">${rel.type} → ${rel.litType}</div>
                                    </div>
                                    <div class="text-blue-400 text-sm font-bold">${(rel.value * 100).toFixed(0)}%</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    ${fusedInto.length > 0 ? `
                    <!-- Fusion Lineage -->
                    <div class="border border-blue-500/30 rounded-lg p-4 bg-blue-500/5">
                        <h4 class="font-grotesk text-lg font-semibold text-white mb-3">Fusion Lineage</h4>
                        <p class="text-sm text-slate-400 mb-3">This LIT has been fused into ${fusedInto.length} other LIT${fusedInto.length > 1 ? 's' : ''}:</p>
                        <div class="space-y-2">
                            ${fusedInto.map(fusion => `
                                <div class="bg-slate-800/30 rounded p-3">
                                    <div class="flex justify-between items-center">
                                        <div class="text-white text-sm font-medium cursor-pointer hover:text-blue-400"
                                             onclick="showLITDetail('${fusion.resultID}')">${fusion.resultID}</div>
                                        <div class="text-slate-500 text-xs">${fusion.pattern}</div>
                                    </div>
                                    <div class="text-xs text-slate-500 mt-1">
                                        ${new Date(fusion.timestamp).toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- Actions -->
                    <div class="flex gap-3">
                        <button onclick="closeLITDetail()" class="btn-secondary px-6 py-2 rounded-lg font-medium flex-1">
                            Close
                        </button>
                        <button onclick="selectForFusion('${data.id}')" class="btn-primary px-6 py-2 rounded-lg font-medium flex-1">
                            Select for Fusion
                        </button>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
        };

        // Close LIT detail modal
        window.closeLITDetail = function(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('lit-detail-modal').classList.add('hidden');
        };

        // Select LIT for fusion from detail view
        window.selectForFusion = function(litId) {
            selectedLITsForFusion.add(litId);
            closeLITDetail();
            updateFusionSelector();
            // Scroll to fusion section
            document.getElementById('xenial-fusion').scrollIntoView({ behavior: 'smooth' });
        };

        // Event listeners for filters
        document.getElementById('lit-filter-type').addEventListener('change', function(e) {
            currentFilterType = e.target.value;
            updateLITsRegistry();
        });

        document.getElementById('lit-filter-state').addEventListener('change', function(e) {
            currentFilterState = e.target.value;
            updateLITsRegistry();
        });

        document.getElementById('lit-sort').addEventListener('change', function(e) {
            currentSort = e.target.value;
            updateLITsRegistry();
        });

        // Initialize registry on page load
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateLITsRegistry();
            }, 1500);
        });

        // Update registry periodically
        setInterval(() => {
            updateLITsRegistry();
        }, 10000);
    </script>
</body>
</html>
